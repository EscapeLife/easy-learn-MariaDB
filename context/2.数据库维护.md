## 数据库维护

### 1.1 数据类型

> 数据类型是数据的一种属性，它可以决定数据的存储格式、有效范围和相应的限制。

- **整数类型**

| 数据类型 | 包含的种类 |
| -------- | -------- |
| 整数类型 | MySQL: `integer`/`smallint`；扩展: `tinyint`/`mediumint`/`bigint` |

![imagges](../images/easy-learn-mariadb01.png)

- **浮点数类型和定点数类型**

| 数据类型 | 包含的种类 | 注意要点 |
| -------- | -------- | -------- |
| 浮点数类型 | 单精度(`float`)/双精度(`double`) | `M`为精度(数据总长度)；`D`为标度(小数点精度) |
| 定点数类型 | `decimal(M,D)`或`dec(M,D)` | `decimal`和`double`的取值范围相同，但`decimal`由`M`和`D`决定 |

![imagges](../images/easy-learn-mariadb02.png)

- **日期与时间类型**

| 数据类型 | 包含的种类 |
| -------- | -------- |
| 日期与时间类型 | `year`/`date`/`time`/`datetime`/`timestamp` |
| `year` | 插入数值的格式`YYYY`；超过取值范围的年份，会插入0000，查询显示为空 |
| `date` | 插入数值的格式`YYYY-MM-DD`；分隔符可以为任意特殊字符；`current_date`和`now()`表示当前日期 |
| `time` | 插入数值的格式`D HH:MM:SS`，如`2 20:20`表示`68:20:00`；`current_time`和`now()`表示当前时间 |
| `datetime` | 插入数值的格式`YYYY-MM-DD HH:MM:SS`；分隔符可以为任意特殊字符；`now()`表示当前日期和时间 |
| `timestamp` | 大致与`datetime`使用方法类似，但是取值范围比较小；`timestamp`可以根据时区来显示日期和时间 |

![imagges](../images/easy-learn-mariadb03.png)

- **字符串类型**

| 数据类型 | 对于解释 |
| -------- | -------- |
| `char` | 定长字符串，取值范围`0~255` |
| `varchar` | 变长字符串，取值范围`0~65535` |
| `text` | 包含类型`tinytext`/`text`/`mediumtext`/`longtext` |
| `enum` | 枚举类型的定义格式为`enum('value1'， 'value2', ...)`；最多取值范围为`65535`个值 |
| `set` | 基本形式和`enum`类型一样，但值可以为列表中的一个或多个元素组成；最多只能有`64`个元素组成 |

![imagges](../images/easy-learn-mariadb04.png)

- **二进制类型**

| 数据类型 | 对于解释 |
| -------- | -------- |
| 二进制类型 | `binary`/`varbinary`/`bit`/`tinyblog`/`blob`/`meduimblob`/`longblob` |
| `blob` | `blob`类型主要用来存储图片、PDF文档等二进制文件 |
| `binary` | `binary`/`varbinary`/`bit`类型都是在创建时指定最大长度 |

![imagges](../images/easy-learn-mariadb05.png)

> 常见问题以及解答

- **【问题1】MariaDB中什么数据类型能够存储路径？**
  - `MariaDB`中可以使用`char`、`varchar`和`text`来存储路径。但是，如果路径中使用`\`符号时会被自动过滤掉。可以使用`/`或`\\`来代替，这样`MariaDB`就不会自动过滤路径的分隔符号了。

- **【问题2】MariaDB中如何使用布尔类型？**
  - 在`SQL`标准中，存储`bool`和`boolean`类型。`MariaDB`为了支持`SQL`类型，也可以定义`bool`和`boolean`类型，但最后都会被转换成`tinyint(1)`格式进行保存。因此，创建表的时候将一个字段定义为`bool`和`boolean`，数据库中真实定义的是`tinyint(1)`格式。

- **【问题3】MariaDB中如何存储JPG图片和MP3音乐？**
  - 一般情况下，数据库中不直接存储图片和音频文件，而是存储图片和音频文件的路径。如果有需要在`MariaDB`中存储，就选择`blob`类型，因为`blob`类型可以用来存储二进制类型的文件。

-----------

### 1.2 操作数据库

> 数据库是指长期存储在计算机内、有组织的和可共享的数据集合。

- **数据库操作**
  - **创建：**`create database 数据库名;`
  - **查看：**`show databases;`
  - **删除：**`drop database 数据库名;`

- **数据库引擎**
  - **查看：**`show engines;`

> 光说不练假把式

- **【练习】登录数据库系统之后，创建student和teacher数据库，之后删除teacher数据库**

```sql
-- 1.登录数据库
bash> mysql -u'mysql' -p'admin'

-- 2.查看数据库已存在的数据库
sql> show databases;

-- 3.查看数据库系统支持的存储引擎类型
-- Transactions:事务处理；XA分布式交易处理规范；Savepoints:保存点
sql> show engines;
sql> show variables like 'storage_engine';

-- 4.创建指定数据库
sql> create database student;
sql> create database teacher;

-- 5.删除指定数据库
sql> drop database teacher;
```

> 常见问题以及解答

- **【问题1】如何选择存储引擎？**
  - 同一个数据库中可以使用多种存储引擎的表。如果一个表要求较高的事务处理，可以选择InnoDB存储引擎。这个数据库中可以将查询要求比较高的表选择MyISAM存储引擎。如果该数据库中需要一个用于查询的临时表，可以选择MEMORY存储引擎。

![imagges](../images/easy-learn-mariadb06.png)

- **【问题2】如何修改默认存储引擎？**
  - 在MariaDB的安装目录下能够找到一个名为my.ini配置文件，通过修改default-storage-engine字段更改默认存储引擎。注意，该配置文件只有重启服务后才会生效。

-----------

### 1.3 增删改查表

> 表是数据库存储数据的基本单位，一个表包含若干个字段或记录。

![imagges](../images/easy-learn-mariadb07.png)

- **约束规范**
  - **主键(primary key)**
  - 主键必须为唯一的
  - 主键的值是非空的
  - 主键可以是单一的字段，也可以使多个字段的组合
  - **外键(foreign key)**
  - 外键用于建立表与表之间的关系，可以为空值
  - 外键必须依赖于数据库中已经存在的父表的主键，且数据类型必须一致
  - **非空约束(not null)**
  - 非空性是指字段的值不能为空值
  - **唯一性约束(unique)**
  - 唯一性是指所有记录中该字段的值不能重复出现
  - **自动增加(auto_increment)**
  - 用于为表中插入的新纪录自动生成唯一的ID值
  - 约束的字段必须为主键的一部分，且该字段可以是任意整数类型
  - **默认值(default)**
  - 不指定的值的时候自动添加默认值

- **创建数据库**
  - `create table 表名 (属性 类型);`

- **查看数据库**
  - `desc 表名;`
  -`show create table 表名;`

- **修改数据库**
  - **修改表名：**`alter table 旧表名 rename [to] 新表名;`
  - **修改字段：**`alter table 表名 modify 属性名 数据类型;`
  - **修改位置：**`alter table 表名 modify 属性名1 数据类型 first|after 属性名2;`
  - **修改字段：**`alter table 表名 change 旧属性名 新数据类型;`
  - **增加字段：**`alter table 表名 add 属性名1 数据类型 [完整性约束] [first|after 属性名2];`
  - **删除字段：**`alter table 表名 drop 属性名;`
  - **删除外键：**`alter table 表名 drop foreign key 外键别名;`
  - **存储引擎：**`alter table 表名 engine='存储引擎名';`

- **删除数据库**
  - `drop table 表名;`

> 光说不练假把式

- **【练习1】将在school数据库创建一个teacher表**
  - 创建school数据库
  - 创建teacher表并查看表结构
  - 将teacher表的name字段的数据类型改为varchar(30)
  - 将birthday字段的位置改到sex字段前面
  - 将num字段改名为t_id
  - 将teacher表的address字段删除
  - 在teacher表中增加名为wages的字段，数据类型为float
  - 将teacher表改名为teacherInfo
  - 将teacher表的存储引擎更改为MyISAM类型

![imagges](../images/easy-learn-mariadb08.png)

```sql
-- 1.创建school数据库
sql> create database school;

-- 2.创建teacher表并查看表结构
sql> use school;
sql> create table teacher(
  ->   id int(4) not null unique primary key auto_increment,
  ->   num int(10) not null unqiue,
  ->   name varchar(20) not null,
  ->   sex boolean not null,
  ->   birthday datetime,
  ->   langages varchar(20) default 'English',
  ->   address varchar(50)
  -> );
-- 简单和详细查看表结构
sql> desc school;
sql> show create table school;

-- 3.将teacher表的name字段的数据类型改为varchar(30)
sql> alter table teacher modify name varchar(30) not null;

-- 4.将birthday字段的位置改到sex字段前面
sql> alter table teacher modify birthday datetime after name;

-- 5.将num字段改名为t_id
sql> alter table teacher change num t_id int(10) not null;

-- 6.将teacher表的address字段删除
sql> alter table teacher drop address;

-- 7.在teacher表中增加名为wages的字段，数据类型为float
sql> alter table teacher add wages float first;

-- 8.将teacher表改名为teacherInfo
sql> alter table teacher rename teacherInfo;

-- 9.将teacher表的存储引擎更改为MyISAM类型
sql> alter table teacherInfo engine=MyISAM;
```

- **【练习2】创建department和worker表**
  - 在example数据库下创建deparment和worker表
  - 删除deparment表

![imagges](../images/easy-learn-mariadb09.png)

```sql
-- 1.在example数据库下创建deparment表
sql> use example;
sql> create table department(
  ->   d_id int(4) not null unique,
  ->   d_name varchar(20) not null nuique,
  ->   function varchar(50),
  ->   address varchar(50),
  ->   primary key(d_id)
  -> );

-- 2.在example数据库下创建worker表
sql> create table woker(
  ->   id int(4) not null unique primary key auto_increment,
  ->   num int(10) not null unique,
  ->   d_id int(4),
  ->   name varchar(20) not null,
  ->   sex varchar(4) not null,
  ->   birthday date,
  ->   address varchar(50),
  ->   constraint worker_fk foreign key(d_id) references department(d_id)
  -> );

-- 3.删除deparment表，提示存在外间约束
sql> drop table department;

-- 4.删除worker表的外键约束
sql> alter table worker drop foreign key worker_fk;

-- 5.重新删除deparment表
sql> drop table department;

-- 补充: 多外键的设定
sql> create table example2(
  ->   id int primary key,
  ->   stu_id int,
  ->   course_id int,
  ->   constraint c_fk foreign key(stu_id, course_id) references example1(stu_id, course_id)
  -> );
```

> 常见问题以及解答

- **【问题1】如何设置外键？**
  - 子表的外键必须依赖父表的某个字段，因此父表必须优先于子表创建。而且，父表中的被依赖字段必须是主键或者组合主键的一个。如果不满足这样的条件，子表将不能创建成功。

- **【问题2】为什么自增不能设置默认值？**
  - 自增字段必须是主键的一部分，而且一个表有且只能有一个自增字段，它可以为任意合法的整数类型。自增字段是没有默认值的，数值从1开始增加逐个增加。

- **【问题3】如何删除父表？**
  - 因为子表的外键约束限制了父表的删除，而且删除过程比较麻烦。
  - 第一种方法：先删除子表的外键约束，然后再删除父表，达到删除父表的目的。
  - 第二种方法：先删除子表再删除父表，这样完全可以达到删除父表的目的，但是必须要牺牲子表。

-----------

